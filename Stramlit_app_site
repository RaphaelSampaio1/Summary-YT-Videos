import streamlit as st
from youtube_transcript_api import YouTubeTranscriptApi
import g4f

st.set_page_config(page_title="Resumo de VÃ­deo do YouTube", layout="centered")

st.title("ğŸ“º Resumo de VÃ­deo do YouTube")
st.markdown("Cole a URL de um vÃ­deo do YouTube para gerar um **resumo em tÃ³picos** com IA.")

# FunÃ§Ã£o para extrair ID do vÃ­deo
def get_video_id(url_yt): 
    return url_yt.split("watch?v=")[-1]

# FunÃ§Ã£o para perguntar ao GPT
def ask_gpt(messages: list) -> str:
    response = g4f.ChatCompletion.create(
        model=g4f.models.gpt_4o,
        messages=messages
    )
    return response

# Interface
url = st.text_input("ğŸ”— Cole aqui a URL do vÃ­deo do YouTube")

if st.button("ğŸš€ Gerar Resumo") and url:
    try:
        st.info("ğŸ”„ Processando...")
        video_id = get_video_id(url)
        transcript = YouTubeTranscriptApi.get_transcript(video_id, languages=['en', 'pt', 'es'])
        transcript_joined = " ".join([line['text'] for line in transcript])

        messages = [
            {"role": "user", "content": f"Resuma em tÃ³picos essa transcriÃ§Ã£o do vÃ­deo do YouTube na linguagem que estiver escrita:\n\n{transcript_joined}"}
        ]

        resposta = ask_gpt(messages)
        st.success("ğŸ“‹ Resumo gerado com sucesso!")
        st.markdown(f"### ğŸ”¹ Resumo:")
        st.markdown(resposta)

    except Exception as e:
        st.error(f"âŒ Erro: {str(e)}")
